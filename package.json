{
  "name": "vsc-toolbox",
  "displayName": "VSC Toolbox",
  "description": "Tools for VS Code",
  "version": "0.1.0",
  "publisher": "pieths",
  "author": {
    "name": "pieths"
  },
  "license": "MIT",
  "engines": {
    "vscode": "^1.85.0"
  },
  "categories": [
    "Other"
  ],
  "activationEvents": [
    "onStartupFinished"
  ],
  "main": "./out/extension.js",
  "contributes": {
    "commands": [
      {
        "command": "vscToolbox.getFileName",
        "title": "Copy File Name",
        "category": "VSC Toolbox"
      },
      {
        "command": "vscToolbox.searchRemoteCode",
        "title": "Search Remote Code",
        "category": "VSC Toolbox"
      },
      {
        "command": "vscToolbox.getWinDbgBreakpointLocation",
        "title": "Get WinDbg Breakpoint Location",
        "category": "VSC Toolbox"
      },
      {
        "command": "vscToolbox.getGnTargetsForFile",
        "title": "Get GN Targets For File",
        "category": "VSC Toolbox"
      },
      {
        "command": "vscToolbox.testLanguageModelTool",
        "title": "Test Language Model Tool",
        "category": "VSC Toolbox"
      },
      {
        "command": "vscToolbox.filterLinesByPattern",
        "title": "Filter Lines By Pattern",
        "category": "VSC Toolbox"
      }
    ],
    "configuration": {
      "title": "VSC Toolbox",
      "properties": {
        "vscToolbox.enable": {
          "type": "boolean",
          "default": true,
          "description": "Enable VSC Toolbox"
        },
        "vscToolbox.logLevel": {
          "type": "string",
          "default": "info",
          "enum": [
            "debug",
            "info",
            "warn",
            "error"
          ],
          "enumDescriptions": [
            "Show all messages including debug",
            "Show info, warning, and error messages",
            "Show warning and error messages only",
            "Show error messages only"
          ],
          "description": "Controls the minimum log level for the Output panel."
        },
        "vscToolbox.searchUrls": {
          "type": "array",
          "default": [
            {
              "name": "Chromium Source",
              "url": "https://source.chromium.org/search?q=\"{query}\""
            },
            {
              "name": "GitHub Code Search",
              "url": "https://github.com/search?q={query}&type=code"
            }
          ],
          "description": "List of code search engines. Each entry should have 'name' and 'url' properties. Use {query} as placeholder.",
          "items": {
            "type": "object",
            "properties": {
              "name": {
                "type": "string",
                "description": "Display name for this search engine"
              },
              "url": {
                "type": "string",
                "description": "URL template with {query} placeholder"
              }
            },
            "required": [
              "name",
              "url"
            ]
          }
        },
        "vscToolbox.windbgModuleName": {
          "type": "string",
          "default": "chrome",
          "description": "Module name to use as prefix for WinDbg breakpoint locations"
        },
        "vscToolbox.contentIndex.workerThreads": {
          "type": "number",
          "default": 0,
          "minimum": 0,
          "description": "Number of worker threads. 0 = auto-detect (use all logical cores)."
        },
        "vscToolbox.contentIndex.includePaths": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "default": [],
          "description": "List of directory paths to include in the index. Only files in these directories (and subdirectories) will be indexed. Empty = index all workspace files."
        },
        "vscToolbox.contentIndex.excludePatterns": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "default": [],
          "description": "List of picomatch glob patterns to exclude from the index. Files matching any pattern will not be indexed. Supports brace expansion for compact notation. Example: 'd:/cs/src/chrome/{fuchsia,mac,linux}/**' excludes the fuchsia, mac, and linux subdirectories under chrome."
        },
        "vscToolbox.contentIndex.fileExtensions": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "default": [
            ".c",
            ".cc",
            ".cpp",
            ".h",
            ".md"
          ],
          "description": "List of file extensions to include in the index (e.g., '.cc', '.h', '.cpp', '.hpp'). Include the leading dot."
        },
        "vscToolbox.contentIndex.ctagsPath": {
          "type": "string",
          "default": "ctags",
          "description": "Path to the ctags executable. Can be just 'ctags' if it's in your PATH, or an absolute path."
        },
        "vscToolbox.contentIndex.enableEmbeddings": {
          "type": "boolean",
          "default": false,
          "description": "Enable embedding generation and vector/semantic search."
        }
      }
    },
    "languageModelTools": [
      {
        "name": "getWorkspaceSymbol",
        "displayName": "Search Symbols",
        "canBeReferencedInPrompt": true,
        "toolReferenceName": "get-workspace-symbol",
        "userDescription": "Search for symbols (classes, functions, variables, etc.) in code",
        "modelDescription": "Search for symbols (classes, functions, variables, etc.) across the entire codebase using workspace symbol providers. Supports fuzzy/partial matching. Returns symbol names, kinds (Class, Function, Variable, etc.), file locations, container names, source line context, and type details when available. The optional 'filter' parameter can limit results based on specific criteria.",
        "inputSchema": {
          "type": "object",
          "properties": {
            "query": {
              "type": "string",
              "description": "Symbol text to search for. Supports fuzzy matching (e.g., 'MyClass', 'myFunc', 'Vec' will match 'Vector')"
            },
            "include": {
              "type": "string",
              "description": "Optional glob pattern(s) to include only matching file paths. Comma-separated for multiple patterns. Uses VS Code/picomatch glob syntax. Examples: '**/*.cc' (only .cc files), '**/media/**' (files in media directories), '**/*.cc, **/*.h' (both .cc and .h files). If not specified, all indexed files are searched."
            },
            "exclude": {
              "type": "string",
              "description": "Optional glob pattern(s) to exclude matching file paths. Comma-separated for multiple patterns. Applied after include filter. Examples: '**/test/**' (exclude test directories), '**/*mojom*' (exclude mojom files), '**/test/**, **/*_unittest.cc' (exclude tests). Common exclusions: test files, mojom files, third_party."
            },
            "filter": {
              "type": "string",
              "description": "Optional natural language filter to include or exclude symbols AFTER searching. Use for complex semantic filtering that requires AI reasoning. Examples: 'only class methods', 'only static methods', 'exclude private members', 'functions that take a string parameter'. For simple path filtering, prefer using include/exclude instead as they are faster."
            }
          },
          "required": [
            "query"
          ]
        }
      },
      {
        "name": "getDocumentSymbolReferences",
        "displayName": "Find References",
        "canBeReferencedInPrompt": true,
        "toolReferenceName": "get-document-symbol-references",
        "userDescription": "Find all references to a symbol at a specific location",
        "modelDescription": "Find all references to a symbol at a specific location in a file. Returns all locations where the symbol is used throughout the codebase, including declarations, along with source context (up to 10 lines before and 10 lines after each reference, constrained to method boundaries when applicable). Use this to understand how a symbol is used, find all call sites of a function, or see where a variable is accessed. Requires exact file URI (file:// format), zero-based line/character position, the symbol name, and the complete source line text. The symbol name and source line are used to verify and correct the exact position, helping prevent off-by-one errors.",
        "inputSchema": {
          "type": "object",
          "properties": {
            "uri": {
              "type": "string",
              "description": "File URI in file:// format (e.g., 'file:///c:/path/to/file.cpp' on Windows or 'file:///path/to/file.cpp' on Unix)"
            },
            "position": {
              "type": "object",
              "properties": {
                "line": {
                  "type": "number",
                  "description": "Zero-based line number (first line is 0)"
                },
                "character": {
                  "type": "number",
                  "description": "Zero-based character offset within the line (first character is 0)"
                }
              },
              "required": [
                "line",
                "character"
              ],
              "description": "Position of the symbol in the document"
            },
            "symbolName": {
              "type": "string",
              "description": "The name of the symbol to find references for"
            },
            "sourceLine": {
              "type": "string",
              "description": "The complete source line containing the symbol (used to verify the exact location)"
            },
            "include": {
              "type": "string",
              "description": "Optional glob pattern(s) to include only matching file paths. Comma-separated for multiple patterns. Uses VS Code/picomatch glob syntax. Examples: '**/*.cc' (only .cc files), '**/media/**' (files in media directories), '**/*.cc, **/*.h' (both .cc and .h files). If not specified, all indexed files are searched."
            },
            "exclude": {
              "type": "string",
              "description": "Optional glob pattern(s) to exclude matching file paths. Comma-separated for multiple patterns. Applied after include filter. Examples: '**/test/**' (exclude test directories), '**/*mojom*' (exclude mojom files), '**/test/**, **/*_unittest.cc' (exclude tests). Common exclusions: test files, mojom files, third_party."
            },
            "filter": {
              "type": "string",
              "description": "Optional natural language filter to include or exclude references AFTER finding them. Use for complex semantic filtering that requires AI reasoning. Examples: 'only call sites (exclude declarations)', 'only assignments', 'only references in class methods', 'exclude forward declarations', 'only references where the symbol is passed as a parameter'. For simple path filtering, prefer using include/exclude instead as they are faster."
            }
          },
          "required": [
            "uri",
            "position",
            "symbolName",
            "sourceLine"
          ]
        }
      },
      {
        "name": "searchIndex",
        "displayName": "Search Index",
        "canBeReferencedInPrompt": true,
        "toolReferenceName": "search-index",
        "userDescription": "Search for patterns across indexed content",
        "modelDescription": "Search for patterns across indexed content. Supports glob patterns (* and ?) and AND operations (space-separated terms). Returns matching lines grouped by file with line numbers. Use this for fast full-text search across large codebases.",
        "inputSchema": {
          "type": "object",
          "properties": {
            "query": {
              "type": "string",
              "description": "Search query. Space-separated terms use AND semantics (all must match somewhere in file). Supports * (zero or more characters) and ? (single char) wildcards."
            },
            "include": {
              "type": "string",
              "description": "Optional glob pattern(s) to include only matching file paths. Comma-separated for multiple patterns. Uses VS Code/picomatch glob syntax. Examples: '**/*.cc' (only .cc files), '**/media/**' (files in media directories), '**/*.cc, **/*.h' (both .cc and .h files). If not specified, all indexed files are searched."
            },
            "exclude": {
              "type": "string",
              "description": "Optional glob pattern(s) to exclude matching file paths. Comma-separated for multiple patterns. Applied after include filter. Examples: '**/test/**' (exclude test directories), '**/*mojom*' (exclude mojom files), '**/test/**, **/*_unittest.cc' (exclude tests). Common exclusions: test files, mojom files, third_party."
            },
            "filter": {
              "type": "string",
              "description": "Optional natural language filter to include or exclude results AFTER searching. Use for complex semantic filtering that requires AI reasoning. Examples: 'only matches in class methods', 'exclude declarations', 'only call sites', 'results where the function takes a string parameter'. For simple path filtering, prefer using include/exclude instead as it's faster."
            },
            "maxResults": {
              "type": "number",
              "description": "Maximum number of files to include in results. Default is 15. Use 0 or -1 for no limit. The total match count is always reported in the summary line regardless of this limit."
            }
          },
          "required": [
            "query"
          ]
        }
      },
      {
        "name": "searchEmbeddings",
        "displayName": "Search Embeddings",
        "canBeReferencedInPrompt": true,
        "toolReferenceName": "search-embeddings",
        "userDescription": "Semantic search across indexed content using embeddings",
        "modelDescription": "Perform semantic search across indexed content using embedding vectors. Takes a natural language or code query and returns the nearest 30 matching chunks ranked by cosine similarity. Each result includes the file path, line range, similarity score, and the actual source lines. Use this for finding semantically related code or content even when exact keywords don't match. Query quality significantly impacts results — craft detailed, specific queries rather than short or vague ones.",
        "inputSchema": {
          "type": "object",
          "properties": {
            "query": {
              "type": "string",
              "description": "A detailed search query to find semantically similar code. For best results: (1) Describe the specific behavior or purpose of the code you're looking for, as if writing a docstring or code comment — e.g. 'skip VP9 and AV1 codecs from hardware secure CDM capability check when feature flag is disabled' rather than 'VP9 codec stuff'. (2) Include likely identifier names, variable names, class names, or function names when known — e.g. 'kHardwareSecureDecryptionVp9 FeatureList IsEnabled VideoCodec'. (3) Combine both approaches for best coverage — e.g. 'check if VP9 profile is supported for hardware decoding kVP9 VP9PROFILE_MIN GetSupportedVideoDecoderConfigs'. Avoid single-word or overly generic queries like 'video' or 'codec support'."
            }
          },
          "required": [
            "query"
          ]
        }
      }
    ]
  },
  "scripts": {
    "vscode:prepublish": "npm run package",
    "compile": "node esbuild.mjs",
    "watch": "node esbuild.mjs --watch",
    "package": "npm run typecheck && node esbuild.mjs --production",
    "typecheck": "tsc --noEmit",
    "lint": "eslint src --ext ts"
  },
  "devDependencies": {
    "@types/node": "^20.0.0",
    "@types/picomatch": "^4.0.2",
    "@types/vscode": "^1.85.0",
    "@typescript-eslint/eslint-plugin": "^6.0.0",
    "@typescript-eslint/parser": "^6.0.0",
    "esbuild": "^0.27.3",
    "eslint": "^8.50.0",
    "typescript": "^5.2.0"
  },
  "dependencies": {
    "@lancedb/lancedb": "^0.26.2",
    "picomatch": "^4.0.3",
    "web-tree-sitter": "^0.26.5"
  }
}
